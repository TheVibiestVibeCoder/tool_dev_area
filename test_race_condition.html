<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Race Condition Stress Test (Dashboard)</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            margin: 0;
        }

        /* Password Screen */
        #passwordScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .password-box {
            background: #111;
            border: 3px solid #0f0;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 20px #0f0;
        }

        .password-box h1 {
            margin-top: 0;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }

        .password-box input {
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px 20px;
            font-size: 18px;
            font-family: monospace;
            width: 250px;
            margin: 20px 0;
        }

        .password-box button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }

        .password-box button:hover {
            background: #0a0;
        }

        .error-msg {
            color: #f00;
            margin-top: 10px;
        }

        /* Main Dashboard */
        #mainDashboard {
            display: none;
        }

        .control-panel {
            background: #111;
            border: 2px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-config {
            background: #0a0a0a;
            border: 1px solid #0f0;
            padding: 15px;
            margin: 15px 0;
        }

        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0a0;
        }

        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }

        input[type="number"], input[type="text"] {
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 8px;
            font-size: 16px;
            font-family: monospace;
            margin: 5px;
        }

        #log {
            background: #111;
            border: 1px solid #333;
            padding: 10px;
            height: 500px;
            overflow-y: auto;
            font-size: 12px;
        }

        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .info { color: #0af; }

        .stats-box {
            display: inline-block;
            background: #0a0a0a;
            border: 2px solid #0f0;
            padding: 15px 25px;
            margin: 10px;
            min-width: 150px;
        }

        .stats-box h3 {
            margin: 0;
            font-size: 14px;
            color: #0af;
        }

        .stats-box .value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .url-display {
            background: #000;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            word-break: break-all;
        }
    </style>
</head>
<body>

<!-- PASSWORD SCREEN -->
<div id="passwordScreen">
    <div class="password-box">
        <h1>ğŸ”’ ZUGRIFF BESCHRÃ„NKT</h1>
        <p>Bitte Passwort eingeben:</p>
        <input type="password" id="passwordInput" placeholder="Passwort" onkeypress="if(event.key==='Enter')checkPassword()">
        <br>
        <button onclick="checkPassword()">EINLOGGEN</button>
        <div id="errorMsg" class="error-msg"></div>
    </div>
</div>

<!-- MAIN DASHBOARD -->
<div id="mainDashboard">
    <h1>ğŸ§ª RACE CONDITION TEST DASHBOARD</h1>

    <div class="control-panel">
        <h2>ğŸ“ Test-Konfiguration</h2>

        <div class="url-display">
            <strong>Ziel-URL:</strong> <span id="targetUrl">https://learn.disinfoconsulting.eu/tool_dev_area/index.php?u=user_69652d6c2c1019.29189236</span>
        </div>

        <div class="test-config">
            <h3>Test Einstellungen</h3>

            <label>
                Anzahl gleichzeitiger Requests:
                <input type="number" id="numRequests" value="50" min="1" max="500" style="width: 100px;">
            </label>

            <br><br>

            <label>
                Test-Thema:
                <select id="themaSelect" style="background: #000; border: 2px solid #0f0; color: #0f0; padding: 8px; font-size: 16px; font-family: monospace;">
                    <option value="random">ğŸ² ZufÃ¤llig (Gemischt)</option>
                    <option value="bildung">ğŸ“š Bildung</option>
                    <option value="social">ğŸ“± Social Media</option>
                    <option value="individuell">ğŸ‘¤ Individuell</option>
                    <option value="politik">âš–ï¸ Politik</option>
                    <option value="kreativ">ğŸ’¡ Kreativ</option>
                </select>
            </label>

            <br><br>

            <button onclick="runStressTest()">â–¶ START STRESS TEST</button>
            <button onclick="runMultipleTests()">ğŸ” MEHRERE TESTS (5x)</button>
            <button onclick="clearLog()">ğŸ—‘ CLEAR LOG</button>
            <button onclick="checkResults()">ğŸ“Š CHECK RESULTS</button>
        </div>
    </div>

    <!-- Statistics -->
    <div class="control-panel">
        <h2>ğŸ“Š Statistiken</h2>
        <div class="stats-box">
            <h3>TOTAL TESTS</h3>
            <div class="value" id="totalTests">0</div>
        </div>
        <div class="stats-box success">
            <h3>ERFOLG</h3>
            <div class="value" id="successCount">0</div>
        </div>
        <div class="stats-box error">
            <h3>FEHLER</h3>
            <div class="value" id="errorCount">0</div>
        </div>
        <div class="stats-box info">
            <h3>DAUER (Ã˜)</h3>
            <div class="value" id="avgDuration">0s</div>
        </div>
    </div>

    <div id="status" style="margin: 20px 0; font-size: 18px;">
        <strong>Status:</strong> <span id="statusText" class="info">Bereit</span>
    </div>

    <div id="log"></div>
</div>

<script>
    // ================== PASSWORD PROTECTION ==================
    const CORRECT_PASSWORD = "test123"; // Einfaches Passwort - kann leicht geÃ¤ndert werden

    function checkPassword() {
        const input = document.getElementById('passwordInput').value;
        const errorMsg = document.getElementById('errorMsg');

        if (input === CORRECT_PASSWORD) {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('mainDashboard').style.display = 'block';
            log('âœ… Zugriff gewÃ¤hrt', 'success');
        } else {
            errorMsg.textContent = 'âŒ Falsches Passwort!';
            document.getElementById('passwordInput').value = '';
            setTimeout(() => { errorMsg.textContent = ''; }, 3000);
        }
    }

    // ================== MAIN DASHBOARD ==================
    const LOG = document.getElementById('log');
    const STATUS = document.getElementById('statusText');

    // Statistics
    let stats = {
        totalTests: 0,
        successCount: 0,
        errorCount: 0,
        durations: []
    };

    // Target URL
    const TARGET_URL = 'https://learn.disinfoconsulting.eu/tool_dev_area/index.php?u=user_69652d6c2c1019.29189236';

    // Extract user ID from TARGET_URL
    const USER_ID = new URLSearchParams(new URL(TARGET_URL).search).get('u');
    const EINGABE_URL = `eingabe.php?u=${USER_ID}`;

    // --- CONTENT GENERATOR ---
    const buzzwords = [
        "Desinformation", "Fake News", "Medienkompetenz", "Algorithmen", "Filterblasen",
        "Schulsystem", "Politik", "Transparenz", "Gesetze", "Plattformen", "TikTok",
        "KI-Generierung", "QuellenprÃ¼fung", "Demokratie", "Hassrede"
    ];

    const starters = [
        "Ich finde, wir mÃ¼ssen", "Es ist absolut wichtig, dass", "Warum wird nicht endlich",
        "In der Schule fehlt", "Meiner Meinung nach sollte", "Die Regierung muss",
        "Wir brauchen dringend", "Es kann nicht sein, dass", "Eine Idee wÃ¤re:",
        "Vielleicht kÃ¶nnten wir", "Stop mit", "Mehr Geld fÃ¼r"
    ];

    const actions = [
        "strengere Regeln einfÃ¼hren", "die Lehrer besser fortbilden", "das Ganze verbieten",
        "Faktenchecks finanzieren", "kritisch hinterfragen", "die Konzerne zerschlagen",
        "bessere AufklÃ¤rung betreiben", "schon im Kindergarten anfangen",
        "Algorithmen offenlegen", "Deepfakes kennzeichnen"
    ];

    const endings = [
        "um unsere Gesellschaft zu schÃ¼tzen.", "damit Kinder sicher sind.", "und zwar sofort!",
        "weil es sonst zu spÃ¤t ist.", "â€“ das wÃ¤re mein Vorschlag.", "!!!",
        "oder was meint ihr?", "Punkt.", "im groÃŸen Stil."
    ];

    const emojis = ["ğŸ˜¡", "ğŸ¤”", "ğŸ’¡", "ğŸ“š", "ğŸ›‘", "âœ…", "âš–ï¸", "ğŸ“±", "ğŸ¤–", "ğŸ‘€"];

    function generateRealisticContent() {
        const lengthType = Math.random();
        let text = "";

        if (lengthType < 0.3) {
            text = `${starters[Math.floor(Math.random() * starters.length)]} ${buzzwords[Math.floor(Math.random() * buzzwords.length)]}!`;
        } else if (lengthType < 0.7) {
            text = `${starters[Math.floor(Math.random() * starters.length)]} ${actions[Math.floor(Math.random() * actions.length)]}, ${endings[Math.floor(Math.random() * endings.length)]}`;
        } else {
            text = `${starters[Math.floor(Math.random() * starters.length)]} ${actions[Math.floor(Math.random() * actions.length)]}. AuÃŸerdem ist ${buzzwords[Math.floor(Math.random() * buzzwords.length)]} ein riesiges Problem ${endings[Math.floor(Math.random() * endings.length)]}`;
        }

        if (Math.random() > 0.7) {
            text += " " + emojis[Math.floor(Math.random() * emojis.length)];
        }

        return text;
    }

    // --- LOGGING ---
    function log(message, type = 'info') {
        const time = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.className = type;
        entry.textContent = `[${time}] ${message}`;
        LOG.appendChild(entry);
        LOG.scrollTop = LOG.scrollHeight;
    }

    function clearLog() {
        LOG.innerHTML = '';
        log('ğŸ—‘ Log geleert', 'info');
    }

    function setStatus(text, type = 'info') {
        STATUS.textContent = text;
        STATUS.className = type;
    }

    function updateStats() {
        document.getElementById('totalTests').textContent = stats.totalTests;
        document.getElementById('successCount').textContent = stats.successCount;
        document.getElementById('errorCount').textContent = stats.errorCount;

        if (stats.durations.length > 0) {
            const avg = stats.durations.reduce((a, b) => a + b, 0) / stats.durations.length;
            document.getElementById('avgDuration').textContent = avg.toFixed(2) + 's';
        }
    }

    // --- STRESS TEST ---
    async function runStressTest() {
        const numRequests = parseInt(document.getElementById('numRequests').value);
        const selectedThema = document.getElementById('themaSelect').value;

        if (numRequests < 1 || numRequests > 500) {
            log('âš ï¸ UngÃ¼ltige Anzahl! Bitte 1-500 wÃ¤hlen.', 'error');
            return;
        }

        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        log(`ğŸš€ STRESS TEST GESTARTET: ${numRequests} gleichzeitige Requests`, 'warning');
        log(`ğŸ“ Ziel Dashboard: ${TARGET_URL}`, 'info');
        log(`ğŸ“ Eingabe URL: ${EINGABE_URL}`, 'info');
        log(`ğŸ“‚ Thema: ${selectedThema === 'random' ? 'ZufÃ¤llig gemischt' : selectedThema}`, 'info');
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

        setStatus(`Running ${numRequests} requests...`, 'warning');

        const promises = [];
        const startTime = Date.now();

        for (let i = 1; i <= numRequests; i++) {
            const formData = new FormData();
            const fakeContent = generateRealisticContent();
            const thema = selectedThema === 'random' ? getRandomThema() : selectedThema;

            formData.append('thema', thema);
            formData.append('idee', fakeContent);

            if(numRequests <= 5) log(`ğŸ“¤ Sende: "${fakeContent.substring(0, 30)}..." an ${thema}`, 'info');

            const promise = fetch(EINGABE_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return { success: true, id: i };
                } else {
                    return { success: false, id: i, status: response.status };
                }
            })
            .catch(error => {
                return { success: false, id: i, error: error.message };
            });

            promises.push(promise);
        }

        const results = await Promise.all(promises);
        const endTime = Date.now();
        const duration = (endTime - startTime) / 1000;

        const successful = results.filter(r => r.success).length;
        const failed = results.filter(r => !r.success).length;

        // Update statistics
        stats.totalTests += numRequests;
        stats.successCount += successful;
        stats.errorCount += failed;
        stats.durations.push(duration);
        updateStats();

        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        log(`âœ… Erfolgreich: ${successful}/${numRequests}`, 'success');
        if(failed > 0) log(`âŒ Fehlgeschlagen: ${failed}/${numRequests}`, 'error');
        log(`â±ï¸ Dauer: ${duration.toFixed(2)} Sekunden`, 'info');
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

        if (failed === 0) {
            setStatus('âœ… Test beendet (Alle OK)', 'success');
        } else {
            setStatus(`âš ï¸ Test beendet (${failed} Fehler)`, 'error');
        }

        log('â¡ï¸ Klicke "CHECK RESULTS" um den Inhalt zu prÃ¼fen', 'info');
    }

    // --- MULTIPLE TESTS ---
    async function runMultipleTests() {
        const numRounds = 5;
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'warning');
        log(`ğŸ” STARTE ${numRounds} AUFEINANDERFOLGENDE TESTS`, 'warning');
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'warning');

        for (let i = 1; i <= numRounds; i++) {
            log(`\nğŸ”„ RUNDE ${i}/${numRounds}`, 'warning');
            await runStressTest();

            // Kurze Pause zwischen Tests
            if (i < numRounds) {
                log('â¸ï¸ Warte 2 Sekunden...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }

        log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
        log(`âœ… ALLE ${numRounds} RUNDEN ABGESCHLOSSEN!`, 'success');
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
    }

    // --- CHECK RESULTS ---
    async function checkResults() {
        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        log('ğŸ” LADE DATEN VOM USER DASHBOARD...', 'info');

        try {
            const response = await fetch(TARGET_URL);
            const html = await response.text();

            // Parse HTML to count entries (basic)
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // Try to find data in the page
            log('âœ… Dashboard erfolgreich geladen', 'success');
            log(`ğŸ“„ HTML LÃ¤nge: ${html.length} Zeichen`, 'info');

            // You can add more specific parsing here if needed
            const ideas = doc.querySelectorAll('.idea-card, .entry, [data-entry]');
            if (ideas.length > 0) {
                log(`ğŸ“Š Gefundene EintrÃ¤ge: ${ideas.length}`, 'info');
            } else {
                log('â„¹ï¸ Keine spezifischen EintrÃ¤ge gefunden (HTML manuell prÃ¼fen)', 'warning');
            }

            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

        } catch (error) {
            log(`âŒ Fehler beim Laden: ${error.message}`, 'error');
            log('â„¹ï¸ MÃ¶glicherweise CORS-Problem - Dashboard manuell im Browser Ã¶ffnen', 'warning');
        }
    }

    function getRandomThema() {
        const themen = ['bildung', 'social', 'individuell', 'politik', 'kreativ'];
        return themen[Math.floor(Math.random() * themen.length)];
    }
</script>

</body>
</html>
